<script>
    const OWNER = 'hakankacar2014-demir';
    const REPO = 'free-vector-stock';

    async function load() {
        const gallery = document.getElementById('gallery');
        try {
            const res = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/vectors`);
            const dirs = await res.json();
            
            for(let d of dirs) {
                if(d.type === 'dir') {
                    const fRes = await fetch(d.url);
                    const files = await fRes.json();
                    
                    const jpgFile = files.find(f => f.name.toLowerCase().endsWith('.jpg'));
                    const epsFile = files.find(f => f.name.toLowerCase().endsWith('.eps'));

                    if (jpgFile && epsFile) {
                        const card = `
                            <div class="card">
                                <img src="${jpgFile.download_url}">
                                <div class="card-info">
                                    <div class="card-title">${d.name.replace(/-/g, ' ').toUpperCase()}</div>
                                    <button onclick="downloadFile('${epsFile.download_url}', '${d.name}.eps')" class="download-btn">EPS İNDİR</button>
                                </div>
                            </div>`;
                        gallery.innerHTML += card;
                    }
                }
            }
        } catch(e) { console.error("Yükleme hatası:", e); }
    }

    // Tarayıcının dosyayı açmasını engelleyip direkt indirmesini sağlayan fonksiyon
    function downloadFile(url, filename) {
        fetch(url)
            .then(response => response.blob())
            .then(blob => {
                const blobUrl = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = blobUrl;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                a.remove();
                window.URL.revokeObjectURL(blobUrl);
            })
            .catch(e => alert('İndirme başarısız oldu!'));
    }

    load();
</script>
