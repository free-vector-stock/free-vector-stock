<!DOCTYPE html>
<!-- saved from url=(0050)https://a2293a38.free-vector-stock.pages.dev/admin -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <title>ADMIN - FREE VECTOR STOCK (Cloudflare Edition)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body{font-family:'Segoe UI',Arial,sans-serif;background:#f0f2f5;margin:0;padding:20px;display:flex;flex-direction:column;align-items:center;min-height:100vh}
        .container{background:#fff;padding:30px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.1);width:100%;max-width:800px;margin-bottom:20px}
        h2{text-align:center;margin-bottom:20px;color:#1a1a1a;border-bottom:2px solid #000;padding-bottom:10px}
        input,button,select{width:100%;padding:12px;margin-bottom:15px;border:1px solid #ddd;border-radius:6px;box-sizing:border-box}
        button{background:#000;color:#fff;font-weight:bold;cursor:pointer;border:none;transition:0.3s}
        button:hover{background:#333}
        button:disabled{background:#ccc;cursor:not-allowed}
        #status{max-height:300px;overflow-y:auto;background:#fafafa;padding:15px;border-radius:6px;font-size:12px;border:1px solid #eee;margin-bottom:20px}
        .success{color:#27ae60;font-weight:bold;margin-bottom:5px} 
        .error{color:#e74c3c;font-weight:bold;margin-bottom:5px}
        .info{font-size:11px;color:#666;text-align:center;margin-bottom:10px}
        
        .stats-container { background:#fff; padding:20px; border-radius:12px; box-shadow:0 5px 15px rgba(0,0,0,0.05); width:100%; max-width:800px; overflow-x:auto; }
        table { width:100%; border-collapse:collapse; font-size:14px; }
        th, td { padding:12px; text-align:left; border-bottom:1px solid #eee; }
        th { background:#f8f8f8; font-weight:bold; color:#333; }
        tr:hover { background:#fafafa; }
        .badge { background:#000; color:#fff; padding:4px 10px; border-radius:12px; font-size:12px; font-weight:bold; }
        .count-cell { font-weight:900; color:#000; font-size:16px; }
    </style>
</head>
<body>
    <div class="container">
        <h2>CLOUDFLARE STOCK PANEL</h2>
        <p class="info">Bu panel doğrudan Cloudflare R2 ve KV kullanarak çalışır. GitHub gerekmez.</p>
        
        <div id="authSection">
            <input type="password" id="adminKey" placeholder="Admin Access Key">
        </div>

        <input type="file" id="fileInput" multiple="">
        <button id="uploadBtn" onclick="startUpload()">START MULTI-UPLOAD TO CLOUDFLARE</button>
        <div id="status">Ready...</div>
        <button onclick="loadStats()" style="background:#444; margin-top:10px;">REFRESH CATEGORY STATS</button>
    </div>

    <div class="stats-container">
        <h3 style="margin-top:0; font-size:18px; border-bottom:2px solid #000; padding-bottom:10px; margin-bottom:15px;">Category Download Statistics</h3>
        <table id="statsTable">
            <thead>
                <tr>
                    <th>Category Name</th>
                    <th style="text-align:center;">Total Downloads</th>
                    <th style="text-align:center;">Total Vectors</th>
                </tr>
            </thead>
            <tbody id="statsBody"><tr>
                <td><span class="badge">Abstract</span></td>
                <td style="text-align:center;" class="count-cell">1</td>
                <td style="text-align:center; color:#666;">10 Vectors</td>
            </tr><tr>
                <td><span class="badge">Animals/Wildlife</span></td>
                <td style="text-align:center;" class="count-cell">2</td>
                <td style="text-align:center; color:#666;">50 Vectors</td>
            </tr><tr>
                <td><span class="badge">Backgrounds/Textures</span></td>
                <td style="text-align:center;" class="count-cell">1</td>
                <td style="text-align:center; color:#666;">31 Vectors</td>
            </tr><tr>
                <td><span class="badge">Beauty/Fashion</span></td>
                <td style="text-align:center;" class="count-cell">0</td>
                <td style="text-align:center; color:#666;">0 Vectors</td>
            </tr><tr>
                <td><span class="badge">Buildings/Landmarks</span></td>
                <td style="text-align:center;" class="count-cell">0</td>
                <td style="text-align:center; color:#666;">0 Vectors</td>
            </tr><tr>
                <td><span class="badge">Business/Finance</span></td>
                <td style="text-align:center;" class="count-cell">1</td>
                <td style="text-align:center; color:#666;">43 Vectors</td>
            </tr><tr>
                <td><span class="badge">Celebrities</span></td>
                <td style="text-align:center;" class="count-cell">0</td>
                <td style="text-align:center; color:#666;">0 Vectors</td>
            </tr><tr>
                <td><span class="badge">Drink</span></td>
                <td style="text-align:center;" class="count-cell">0</td>
                <td style="text-align:center; color:#666;">150 Vectors</td>
            </tr><tr>
                <td><span class="badge">Education</span></td>
                <td style="text-align:center;" class="count-cell">0</td>
                <td style="text-align:center; color:#666;">0 Vectors</td>
            </tr><tr>
                <td><span class="badge">Font</span></td>
                <td style="text-align:center;" class="count-cell">1</td>
                <td style="text-align:center; color:#666;">83 Vectors</td>
            </tr><tr>
                <td><span class="badge">Food</span></td>
                <td style="text-align:center;" class="count-cell">21</td>
                <td style="text-align:center; color:#666;">47 Vectors</td>
            </tr><tr>
                <td><span class="badge">Healthcare/Medical</span></td>
                <td style="text-align:center;" class="count-cell">0</td>
                <td style="text-align:center; color:#666;">0 Vectors</td>
            </tr><tr>
                <td><span class="badge">Holidays</span></td>
                <td style="text-align:center;" class="count-cell">0</td>
                <td style="text-align:center; color:#666;">0 Vectors</td>
            </tr><tr>
                <td><span class="badge">Icon</span></td>
                <td style="text-align:center;" class="count-cell">0</td>
                <td style="text-align:center; color:#666;">80 Vectors</td>
            </tr><tr>
                <td><span class="badge">Industrial</span></td>
                <td style="text-align:center;" class="count-cell">0</td>
                <td style="text-align:center; color:#666;">0 Vectors</td>
            </tr><tr>
                <td><span class="badge">Interiors</span></td>
                <td style="text-align:center;" class="count-cell">0</td>
                <td style="text-align:center; color:#666;">0 Vectors</td>
            </tr><tr>
                <td><span class="badge">Logo</span></td>
                <td style="text-align:center;" class="count-cell">0</td>
                <td style="text-align:center; color:#666;">66 Vectors</td>
            </tr><tr>
                <td><span class="badge">Miscellaneous</span></td>
                <td style="text-align:center;" class="count-cell">0</td>
                <td style="text-align:center; color:#666;">1 Vectors</td>
            </tr><tr>
                <td><span class="badge">Nature</span></td>
                <td style="text-align:center;" class="count-cell">0</td>
                <td style="text-align:center; color:#666;">0 Vectors</td>
            </tr><tr>
                <td><span class="badge">Objects</span></td>
                <td style="text-align:center;" class="count-cell">0</td>
                <td style="text-align:center; color:#666;">0 Vectors</td>
            </tr><tr>
                <td><span class="badge">Parks/Outdoor</span></td>
                <td style="text-align:center;" class="count-cell">0</td>
                <td style="text-align:center; color:#666;">0 Vectors</td>
            </tr><tr>
                <td><span class="badge">People</span></td>
                <td style="text-align:center;" class="count-cell">0</td>
                <td style="text-align:center; color:#666;">0 Vectors</td>
            </tr><tr>
                <td><span class="badge">Religion</span></td>
                <td style="text-align:center;" class="count-cell">0</td>
                <td style="text-align:center; color:#666;">0 Vectors</td>
            </tr><tr>
                <td><span class="badge">Science</span></td>
                <td style="text-align:center;" class="count-cell">0</td>
                <td style="text-align:center; color:#666;">0 Vectors</td>
            </tr><tr>
                <td><span class="badge">Signs/Symbols</span></td>
                <td style="text-align:center;" class="count-cell">0</td>
                <td style="text-align:center; color:#666;">0 Vectors</td>
            </tr><tr>
                <td><span class="badge">Sports/Recreation</span></td>
                <td style="text-align:center;" class="count-cell">0</td>
                <td style="text-align:center; color:#666;">0 Vectors</td>
            </tr><tr>
                <td><span class="badge">Technology</span></td>
                <td style="text-align:center;" class="count-cell">0</td>
                <td style="text-align:center; color:#666;">0 Vectors</td>
            </tr><tr>
                <td><span class="badge">The Arts</span></td>
                <td style="text-align:center;" class="count-cell">0</td>
                <td style="text-align:center; color:#666;">0 Vectors</td>
            </tr><tr>
                <td><span class="badge">Transportation</span></td>
                <td style="text-align:center;" class="count-cell">0</td>
                <td style="text-align:center; color:#666;">0 Vectors</td>
            </tr><tr>
                <td><span class="badge">Vintage</span></td>
                <td style="text-align:center;" class="count-cell">0</td>
                <td style="text-align:center; color:#666;">0 Vectors</td>
            </tr></tbody>
        </table>
    </div>

<script>
const cats = ["Abstract","Animals/Wildlife","The Arts","Backgrounds/Textures","Beauty/Fashion","Buildings/Landmarks","Business/Finance","Celebrities","Education","Food","Drink","Healthcare/Medical","Holidays","Industrial","Interiors","Miscellaneous","Nature","Objects","Parks/Outdoor","People","Religion","Science","Signs/Symbols","Sports/Recreation","Technology","Transportation","Vintage","Logo","Font","Icon"];

function getCat(filename){
    let prefix = filename.split('-')[0].toLowerCase();
    let found = cats.find(c => c.toLowerCase().replace(/[^a-z]/g,"").includes(prefix));
    return found || "Miscellaneous";
}

async function startUpload() {
    const adminKey = document.getElementById('adminKey').value;
    const files = Array.from(document.getElementById('fileInput').files);
    const status = document.getElementById('status');
    const btn = document.getElementById('uploadBtn');
    
    if(!adminKey) { alert("Admin Key required!"); return; }
    if(files.length === 0) { alert("Please select files!"); return; }
    
    btn.disabled = true;
    btn.innerText = "UPLOADING...";
    status.innerHTML = "Starting upload process to Cloudflare...<br>";

    let newEntries = [];

    // Dosyaları gruplandır (jpg, zip, json)
    const groupedFiles = {};
    files.forEach(f => {
        const baseName = f.name.replace(/\.[^/.]+$/, "");
        if(!groupedFiles[baseName]) groupedFiles[baseName] = {};
        const ext = f.name.split('.').pop().toLowerCase();
        groupedFiles[baseName][ext] = f;
    });

    for (const [baseName, group] of Object.entries(groupedFiles)) {
        const cat = getCat(baseName);
        
        const itemDiv = document.createElement('div');
        itemDiv.style.marginBottom = "10px";
        itemDiv.innerHTML = `<b>Processing: ${baseName}</b><br>`;
        status.appendChild(itemDiv);

        try {
            // 1. JSON dosyasını oku (varsa)
            let meta = { description: "Professional stock vector for commercial use.", keywords: "vector, free, stock" };
            if(group.json) {
                try {
                    const jsonText = await group.json.text();
                    const parsed = JSON.parse(jsonText);
                    meta.description = parsed.description || meta.description;
                    meta.keywords = parsed.keywords || meta.keywords;
                } catch(e) { console.error("JSON parse error", e); }
            }

            // 2. Dosyaları R2'ye yükle (Worker üzerinden)
            for (const [ext, file] of Object.entries(group)) {
                if(ext === 'json') continue; // JSON'u veritabanına yazacağız, R2'ye gerek yok

                const uploadDiv = document.createElement('div');
                uploadDiv.innerText = `Uploading ${file.name}...`;
                itemDiv.appendChild(uploadDiv);

                const formData = new FormData();
                formData.append('file', file);
                formData.append('category', cat);
                formData.append('key', adminKey);

                const res = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                });

                if(res.ok) {
                    uploadDiv.innerHTML = `<span class="success">✓ Uploaded: ${file.name}</span>`;
                } else {
                    const err = await res.text();
                    throw new Error(`Upload failed for ${file.name}: ${err}`);
                }
            }

            // 3. Veritabanı girişi hazırla
            if(group.jpg) {
                newEntries.push({
                    name: baseName,
                    category: cat,
                    description: meta.description,
                    keywords: meta.keywords,
                    date: new Date().toISOString().split('T')[0],
                    downloads: 0
                });
            }

        } catch (e) {
            const errDiv = document.createElement('div');
            errDiv.innerHTML = `<span class="error">✗ Error: ${e.message}</span>`;
            itemDiv.appendChild(errDiv);
        }
        status.scrollTop = status.scrollHeight;
    }

    if(newEntries.length > 0) {
        await updateDatabase(newEntries, adminKey);
    }
    
    btn.disabled = false;
    btn.innerText = "START MULTI-UPLOAD TO CLOUDFLARE";
    status.innerHTML += "<br><b>Process completed.</b>";
    loadStats();
}

async function updateDatabase(newEntries, adminKey) {
    const status = document.getElementById('status');
    const dbDiv = document.createElement('div');
    dbDiv.innerText = "Updating Cloudflare KV Database...";
    status.appendChild(dbDiv);

    try {
        const res = await fetch('/api/database', {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json',
                'X-Admin-Key': adminKey
            },
            body: JSON.stringify(newEntries)
        });

        if(res.ok) dbDiv.innerHTML = `<span class="success">✓ Database updated in Cloudflare KV!</span>`;
        else throw new Error("DB update failed");
    } catch(e) {
        dbDiv.innerHTML = `<span class="error">✗ DB Error: ${e.message}</span>`;
    }
}

async function loadStats() {
    const body = document.getElementById('statsBody');
    body.innerHTML = "<tr><td colspan='3' style='text-align:center;'>Loading statistics...</td></tr>";
    
    try {
        const res = await fetch('/api/database');
        if(!res.ok) throw new Error("Database not found");
        const data = await res.json();
        
        const summary = {};
        cats.forEach(c => summary[c] = { downloads: 0, count: 0 });
        
        data.forEach(item => {
            if(summary[item.category]) {
                summary[item.category].downloads += (item.downloads || 0);
                summary[item.category].count += 1;
            } else {
                if(!summary["Miscellaneous"]) summary["Miscellaneous"] = { downloads: 0, count: 0 };
                summary["Miscellaneous"].downloads += (item.downloads || 0);
                summary["Miscellaneous"].count += 1;
            }
        });

        body.innerHTML = "";
        cats.sort().forEach(cat => {
            const tr = document.createElement('tr');
            const stats = summary[cat];
            tr.innerHTML = `
                <td><span class="badge">${cat}</span></td>
                <td style="text-align:center;" class="count-cell">${stats.downloads}</td>
                <td style="text-align:center; color:#666;">${stats.count} Vectors</td>
            `;
            body.appendChild(tr);
        });
        
    } catch(e) {
        body.innerHTML = `<tr><td colspan="3" style="text-align:center; color:red;">Error: ${e.message}</td></tr>`;
    }
}

window.onload = loadStats;
</script>


</body></html>