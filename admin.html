<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ADMIN - FREE VECTOR STOCK</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body{font-family:'Segoe UI',Arial;background:#f4f4f4;margin:0;padding:20px;display:flex;justify-content:center}
        .container{background:#fff;padding:30px;border-radius:8px;box-shadow:0 4px 15px rgba(0,0,0,0.1);width:100%;max-width:600px}
        h1{font-size:20px;margin-bottom:20px;border-bottom:20px;color:#000}
        .box{border:2px dashed #ccc;padding:20px;text-align:center;margin-bottom:20px}
        input,button{width:100%;padding:12px;margin-top:10px;border-radius:4px;border:1px solid #ddd;box-sizing:border-box}
        button{background:#000;color:#fff;font-weight:bold;cursor:pointer;border:none}
        button:hover{background:#333}
        #log{margin-top:20px;font-size:12px;max-height:200px;overflow-y:auto;background:#eee;padding:10px}
        .success{color:green} .error{color:red}
    </style>
</head>
<body>

<div class="container">
    <h1>Stock Upload Panel</h1>
    <p style="font-size:12px">Select JPG, ZIP, and JSON files together. They must have the same name.</p>
    
    <input type="password" id="token" placeholder="GitHub Personal Access Token">
    <div class="box">
        <input type="file" id="fileInput" multiple>
    </div>
    <button onclick="startUpload()">START MULTI-UPLOAD</button>

    <div id="log"></div>
</div>

<script>
const repo = "free-vector-stock/free-vector-stock";
const categories = ["Abstract","Animals/Wildlife","The Arts","Backgrounds/Textures","Beauty/Fashion","Buildings/Landmarks","Business/Finance","Celebrities","Education","Food","Drink","Healthcare/Medical","Holidays","Industrial","Interiors","Miscellaneous","Nature","Objects","Parks/Outdoor","People","Religion","Science","Signs/Symbols","Sports/Recreation","Technology","Transportation","Vintage","Logo","Font","Icon"];

function getCategory(fname) {
    let prefix = fname.split('-')[0].toLowerCase();
    return categories.find(c => c.toLowerCase().replace(/[^a-z]/g,"").includes(prefix.replace(/[^a-z]/g,""))) || "Miscellaneous";
}

async function startUpload() {
    const token = document.getElementById('token').value;
    const files = document.getElementById('fileInput').files;
    const log = document.getElementById('log');
    if(!token || files.length === 0) return alert("Token and files required!");

    for(let file of files) {
        let cat = getCategory(file.name);
        let path = `assets/${cat}/${file.name}`;
        let reader = new FileReader();
        
        reader.onload = async function(e) {
            let content = e.target.result.split(',')[1];
            let api = `https://api.github.com/repos/${repo}/contents/${path}`;
            
            // Check for existing file to get SHA
            let sha = "";
            let check = await fetch(api, { headers: { Authorization: `token ${token}` } });
            if(check.ok) { let res = await check.json(); sha = res.sha; }

            let response = await fetch(api, {
                method: "PUT",
                headers: { Authorization: `token ${token}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    message: `Upload ${file.name}`,
                    content: content,
                    sha: sha || undefined
                })
            });

            if(response.ok) log.innerHTML += `<div class="success">Uploaded: ${file.name} to ${cat}</div>`;
            else log.innerHTML += `<div class="error">Failed: ${file.name}</div>`;
        };
        reader.readAsDataURL(file);
    }
}
</script>
</body>
</html>
